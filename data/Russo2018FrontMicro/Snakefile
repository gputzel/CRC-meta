configfile: "config.json"

SRP=config['SRP']

#rule download_runinfo:
#    output:
#        "sample_data/runinfo.csv"
#    shell:
#        'esearch -db sra -query "{SRP}" | efetch -format runinfo > sample_data/runinfo.csv'

rule download_xml:
    output:
        "sample_data/sra-info.xml"
    shell:
        'esearch -db sra -query "{SRP}" | efetch -format summary | xmllint --format - > sample_data/sra-info.xml'

rule get_sample_info:
    input:
        "sample_data/sra-info.xml"
    output:
        "sample_data/sample_info.csv"
    script:
        "scripts/get_sample_info.py"

rule join_sample_data:
    input:
        "sample_data/sample_info.csv",
        "sample_data/table1.tsv"
    output:
        "sample_data/merged_sample_data.tsv"
    script:
        "scripts/join_sample_data.R"

rule select_samples:
    input:
        "sample_data/merged_sample_data.tsv"
    output:
        "sample_data/merged_sample_data_subset.tsv"
    script:
        "scripts/select_samples.R"

rule download_sra:
    input:
        "sample_data/merged_sample_data_subset.tsv"
    output:
        "FASTQ"
    shell:
        "scripts/download_sra.sh"

rule clear_fastq:
    input:
        "FASTQ"
    shell:
        "rm -r FASTQ"

rule fastqc:
    input:
        "FASTQ"
    output:
        "FASTQC"
    shell:
        "scripts/fastqc.sh"

rule rename_fastq:
    input:
        "FASTQ"
    output:
        "FASTQ_renamed/"
    shell:
        "scripts/rename_fastq.sh"
